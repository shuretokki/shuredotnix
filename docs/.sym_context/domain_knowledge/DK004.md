---
tags: [architecture, modules, structure]
---

# DK-004: Module Structure

**Related Code:** `library/`
**Last Updated:** 2026-01-04

## Definition

This document explains the organization of NixOS and Home Manager modules within the `library/` directory.

## Directory Structure

```
library/
├── core/ # System-level NixOS modules (hardware, boot, networking)
├── home/ # Home Manager modules (user applications, dotfiles)
│   └── bundlers/ # Logical groupings of related user packages
│       ├── cli/ # Terminal applications (git, zsh, tmux)
│       └── desktop/# GUI applications (browser, editor, theme)
└── shared/ # Modules used by both NixOS and Home Manager
```

## Design Principles

### 1. Separation of Concerns
- **Core**: System configuration that requires root (services, kernel, hardware).
- **Home**: User configuration that could theoretically run standalone.
- **Shared**: Common utilities, overlays, or option definitions.

### 2. Bundlers Pattern
Bundlers are thematic groupings that enable/disable related packages together.

**Example:** `library/home/bundlers/cli/` might include:
- `git.nix` (version control)
- `gh.nix` (GitHub CLI)
- `zsh.nix` (shell)
- `tmux.nix` (terminal multiplexer)

Enabling the "cli" bundler gives you a complete terminal environment.

### 3. Single Responsibility
Each `.nix` file should configure **one** program or feature. Avoid "mega modules" that configure multiple unrelated things.

## How to Add a New Module

1.  Determine if it is **system** (core) or **user** (home).
2.  Find or create the appropriate bundler subdirectory.
3.  Create a `<program>.nix` file following `CON001` style.
4.  Import it in the bundler's `default.nix` (if applicable).
5.  Update this document if adding a new bundler category.

## Edge Cases

- **Overlays**: Place in `library/shared/overlays/`.
- **Custom Packages**: Place in `packages/` (outside `library/`).
- **Host-Specific Config**: Place in `hosts/<hostname>/` (outside `library/`).
