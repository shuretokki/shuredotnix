---
tags: [ci, github-actions, nix, cache]
---

# TS-003: CI Build Fails with Cache Networking Error

**Related Code:** `.github/workflows/ci.yml`
**Last Updated:** 2026-01-06

## Symptom
CI fails with error:
```
error: some substitutes for the outputs of derivation '...' failed
(usually happens due to networking issues); try '--fallback' to build derivation from source
```

## Cause
Transient networking issue with Nixpkgs binary cache. The cache server was temporarily unavailable for a specific package (commonly VS Code, large packages).

## Solution

### Immediate Fix
- Re-run the CI job (often works on retry)

### Permanent Fix (Applied)
Added `--fallback` and retry logic to CI:
```yaml
- name: Build System
  run: nix build .#desktop --fallback
  continue-on-error: true
  id: build

- name: Retry Build
  if: steps.build.outcome == 'failure'
  run: |
    sleep 30
    nix build .#desktop --fallback
```

## Trade-offs
- `--fallback` builds from source if cache fails (slower: ~15-30 min vs 2-5 min)
- Retry adds 30s delay before second attempt

## Related
- [Nix Manual: Fallback](https://nixos.org/manual/nix/stable/command-ref/conf-file.html)
