---
tags: [architecture, flake, packages]
---

# ADR-004: Flake Packages Mapping

**Status:** Accepted
**Date:** 2026-01-04

## Context

Building a NixOS configuration requires a long command:
```bash
nix build .#nixosConfigurations.desktop.config.system.build.toplevel
```

This is error-prone and unfriendly for CI and users.

## Decision

Add a `packages.x86_64-linux` output that maps hostnames to their system builds:

```nix
packages.x86_64-linux = nixpkgs.lib.mapAttrs
  (hostname: config: config.config.system.build.toplevel)
  self.nixosConfigurations;
```

## Consequences

**Positive:**
- Simpler command: `nix build .#desktop`
- Works with `nix flake show` (packages are discoverable)
- Cleaner CI configuration

**Negative:**
- Slight duplication of output structure
- Must remember to use shorthand

## Alternatives Considered

- **Keep long path**: Rejected - too verbose, CI unfriendly
- **Custom script**: Rejected - Nix native solution preferred
