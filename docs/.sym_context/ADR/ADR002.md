---
tags: [architecture, home-manager, integration]
---

# ADR-002: Home Manager as NixOS Module

**Status:** Accepted
**Date:** 2026-01-04

## Context

Home Manager can be integrated in two ways:
1.  **Standalone**: Run `home-manager switch` separately from `nixos-rebuild`.
2.  **NixOS Module**: Import Home Manager as a NixOS module, managed by `nixos-rebuild`.

## Decision

We integrate Home Manager **as a NixOS module**.

## Consequences

**Positive:**
- **Single Command**: `nixos-rebuild switch` updates both system and user configuration.
- **Atomic Updates**: System and user packages are updated together, reducing version drift.
- **Simpler Workflow**: No need to run two separate commands or maintain two flakes.
- **Shared Inputs**: Home Manager uses the same `nixpkgs` input as the system.

**Negative:**
- **Coupled Rebuilds**: Cannot update user config without rebuilding the system.
- **Root Required**: `nixos-rebuild` requires sudo, even for user-only changes.
- **Multi-User Complexity**: Each user needs their own `home-manager.users.<name>` block.

## Alternatives Considered

- **Standalone Home Manager**: Rejected because it requires maintaining a separate `home.nix` and running two commands.
- **Nix-Darwin Style**: Not applicable (this is NixOS, not macOS).
