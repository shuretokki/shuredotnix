---
tags: [architecture, modules, options]
---

# ADR-005: Migrate from vars.features to library.* Options

**Status:** Accepted
**Date:** 2026-01-05

## Context
The config used `vars.features.desktop` as a global boolean to conditionally include desktop-related modules. This was "all-or-nothing" — couldn't have bluetooth without audio, for example.

## Decision
Replace `vars.features.*` with per-module `library.*` options:
- `library.display.sddm.enable`
- `library.display.hyprland.enable`
- `library.core.audio.enable`
- `library.core.bluetooth.enable`
- `library.core.fonts.enable`
- `library.core.input.enable`
- `library.core.files.enable`

Each module defines `options.library.X.enable` and wraps its config in `lib.mkIf cfg.enable {...}`.

## Consequences

**Positive:**
- Fine-grained control per host
- Type-safe (lib.mkEnableOption)
- Discoverable via `nixos-option`
- Cleaner host configs

**Negative:**
- More boilerplate per module
- Home Manager modules can't use these options (still use vars.features)

## Alternatives Considered
- **Keep vars.features:** Rejected — too coarse
- **Use roles (roles.desktop = true):** Rejected — still bundles too much
