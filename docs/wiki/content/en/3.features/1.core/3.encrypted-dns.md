---
title: Encrypted DNS
description: System-wide encrypted DNS with dnscrypt-proxy2.
navigation:
  icon: i-lucide-shield
---

# Encrypted DNS

This guide explains how to enable system-wide encrypted DNS using dnscrypt-proxy2.

## What You Get

- **Privacy**: Your ISP cannot see which websites you visit
- **Security**: DNSSEC validation prevents DNS spoofing attacks
- **No logging**: Resolvers are required to not log your queries

## Quick Start

Encrypted DNS is enabled by default in this configuration. No action required.

## How It Works

```
Your App → localhost:53 → dnscrypt-proxy → Encrypted → Quad9/Cloudflare
```

All DNS queries go through the local dnscrypt-proxy service, which encrypts them using DNS-over-HTTPS before sending to privacy-focused resolvers.

## Verification

Check if DNS is working:

```bash
# Check service status
systemctl status dnscrypt-proxy

# Test DNS resolution
dig google.com @127.0.0.1

# See which resolver handled your query
sudo dnscrypt-proxy -resolve google.com
```

## Configuration

The DNS configuration lives in `library/core/security/dns.nix`.

### Resolvers

By default, we use:
- **Quad9** (primary) — Privacy-focused, threat intelligence
- **Cloudflare** (fallback) — Fast, reliable

### Customization

To change resolvers, edit the `server_names` list:

```nix
server_names = [ "quad9-doh-ip4-nofilter-ecs-pri" "cloudflare" "mullvad-doh" ];
```

See available resolvers: https://dnscrypt.info/public-servers

## Troubleshooting

### DNS not working after boot

Wait 10-30 seconds for dnscrypt-proxy to download the resolver list on first boot.

### Captive portals (hotels/airports)

Temporarily disable encrypted DNS:

1. Connect to the WiFi
2. Open browser and authenticate with the portal
3. DNS should work afterward

### IPv6 issues

IPv6 DNS is disabled by default for stability. To enable:

```nix
ipv6_servers = true;
block_ipv6 = false;
```

## Learn More

- [How DNS Works](https://howdns.works/) — Visual comic
- [DNSCrypt Docs](https://dnscrypt.info/) — Official documentation
- [NixOS Wiki](https://wiki.nixos.org/wiki/Encrypted_DNS) — NixOS-specific setup
